# 🤖 NodeAppManager 自动化日志监控系统

## 📋 概述

这是一个完整的自动化日志监控系统，在应用启动时自动激活，无需手动干预。系统会自动捕获前端和后端的所有日志输出，并提供实时查看功能。

## 🚀 使用方法

### 1. 标准启动 (推荐)
```bash
./start-dev.sh
```
- ✅ 自动启动后端日志监控
- ✅ 自动激活前端日志收集
- ✅ 创建实时日志文件 `./logs-monitor/realtime.log`
- ✅ 应用关闭时自动清理监控进程

### 2. 查看实时日志
```bash
# 在另一个终端窗口中运行
./view-logs.sh
```
- 📊 实时显示彩色编码的日志输出
- 🔴 红色: 错误信息
- 🟡 黄色: 警告信息  
- 🔵 青色: IPC 调用
- 🟣 紫色: PM2 操作
- 🟢 绿色: 一般信息

### 3. 独立监控模式
```bash
# 仅启动监控系统
./auto-log-monitor.sh monitor

# 查看统一日志
./auto-log-monitor.sh view

# 停止监控
./auto-log-monitor.sh stop
```

## 🔍 监控功能

### 后端监控
- 📝 自动监控 Electron 主进程日志
- 📊 捕获所有 IPC 调用和响应
- 🔧 记录 PM2 操作和状态变化
- 💾 日志持久化到文件系统

### 前端监控
- 🌐 自动重写所有 `console` 方法
- 🚨 捕获未处理的错误和 Promise 拒绝
- 📨 将前端日志转发到主进程记录
- 🔗 提供全局查看和导出方法

### 实时查看
- 📋 统一的日志输出格式
- 🎨 彩色编码便于识别
- ⚡ 实时跟踪，无延迟
- 📁 自动创建和管理日志文件

## 💡 前端日志API

在浏览器开发者工具中可以使用以下方法：

```javascript
// 查看所有日志
showLogs()

// 查看特定类型的日志
showLogs('error')   // 仅错误
showLogs('warn')    // 仅警告
showLogs('info')    // 仅信息

// 导出日志数据 (JSON格式)
exportLogs()

// 查看日志收集器状态
window.logCollector.logs.length  // 总日志数量
```

## 📁 文件结构

```
NodeAppManager/
├── start-dev.sh              # 集成监控的启动脚本
├── view-logs.sh               # 实时日志查看器
├── auto-log-monitor.sh        # 独立监控系统
├── test-auto-monitor.sh       # 监控系统测试
├── logs-monitor/              # 监控文件目录
│   ├── realtime.log          # 实时日志文件
│   ├── monitor.pid           # 监控进程PID
│   └── frontend-inject.js    # 前端注入脚本
└── src/main.tsx              # 集成前端监控
```

## 🔧 自动化特性

### 启动时自动执行
1. 🧹 清理之前的监控进程
2. 📂 创建监控目录和文件
3. 🔄 启动后端日志跟踪
4. 🌐 注入前端监控代码
5. 📋 设置清理陷阱 (Ctrl+C时自动清理)

### 无需手动操作
- ✅ 应用启动时自动激活
- ✅ 前端代码自动注入监控
- ✅ 日志自动分类和着色
- ✅ 进程自动清理和管理

### 智能错误处理
- 🛡️ 监控脚本错误时不影响应用启动
- 🔄 自动重试机制
- 📝 详细的错误日志记录
- 🚨 友好的错误提示

## 🎯 监控验证步骤

1. **启动应用**
   ```bash
   ./start-dev.sh
   ```

2. **确认监控激活**
   - 终端显示: `✅ 日志监控已启动`
   - 文件存在: `./logs-monitor/realtime.log`
   - 进程PID记录: `./logs-monitor/monitor.pid`

3. **测试前端监控**
   - 打开开发者工具
   - 控制台显示: `✅ 自动日志监控已激活`
   - 运行 `showLogs()` 查看收集的日志

4. **查看实时日志**
   ```bash
   # 新终端窗口
   ./view-logs.sh
   ```

5. **测试功能时观察日志**
   - 点击应用功能
   - 观察实时日志输出
   - 查看错误和警告信息

## 🚀 性能优化

- 📊 日志数量限制 (最多1000条)
- 🔄 自动清理旧日志
- 💾 异步日志处理
- 🎯 选择性日志记录

## 🛑 停止监控

监控系统会在以下情况自动停止：
- 按 `Ctrl+C` 停止应用
- 应用正常退出
- 手动运行 `./auto-log-monitor.sh stop`

---

**✅ 这个系统已经完全自动化，每次启动应用时都会自动激活，无需记忆或手动操作！**
